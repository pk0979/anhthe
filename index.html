<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ảnh Thẻ AI – Chuyên Nghiệp & Nhanh Chóng</title>

    <!-- Tailwind CSS v3 CDN (stable, works on GitHub Pages) -->
    <script src="https://cdn.tailwindcss.com?v=3.4.1"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {}
        }
      }
    </script>

    <!-- React 18 UMD (no importmap needed) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel standalone for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- jsPDF -->
    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

    <!-- Lucide Icons via UMD -->
    <script src="https://unpkg.com/lucide@0.475.0/dist/umd/lucide.min.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono&display=swap" rel="stylesheet">

    <style>
      body {
        font-family: 'Inter', sans-serif;
        -webkit-font-smoothing: antialiased;
        background: #F8FAFC;
      }
      .font-mono { font-family: 'JetBrains Mono', monospace; }
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: #f1f5f9; }
      ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
      .glass {
        background: rgba(255,255,255,0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255,255,255,0.3);
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.5} }
      .animate-spin { animation: spin 1s linear infinite; }
      .animate-pulse { animation: pulse 2s cubic-bezier(.4,0,.6,1) infinite; }
      .fade-in { animation: fadeIn .25s ease; }
      @keyframes fadeIn { from{opacity:0;transform:scale(.97)} to{opacity:1;transform:scale(1)} }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useRef, useEffect } = React;

      // --- Lucide icon helper ---
      function Icon({ name, className = "w-5 h-5" }) {
        const ref = useRef(null);
        useEffect(() => {
          if (ref.current && window.lucide) {
            ref.current.innerHTML = '';
            const el = document.createElement('i');
            el.setAttribute('data-lucide', name);
            ref.current.appendChild(el);
            lucide.createIcons({ nodes: [el] });
            const svg = ref.current.querySelector('svg');
            if (svg) {
              svg.removeAttribute('width');
              svg.removeAttribute('height');
              svg.setAttribute('class', className);
            }
          }
        }, [name, className]);
        return <span ref={ref} style={{display:'inline-flex',alignItems:'center'}} />;
      }

      // --- Constants ---
      const GENDERS = [
        { id: "female", label: "Nữ" },
        { id: "male", label: "Nam" }
      ];
      const BACKGROUNDS = [
        { id: "blue", label: "Nền Xanh", hex: "#0074D9", twColor: "bg-blue-600" },
        { id: "white", label: "Nền Trắng", hex: "#FFFFFF", twColor: "bg-white border border-slate-300" }
      ];
      const RATIOS = [
        { id: "3:4", label: "3x4 / 4x6", desc: "Phổ thông" },
        { id: "3.5:4.5", label: "3.5x4.5 cm", desc: "Hộ chiếu/Visa" },
        { id: "1:1", label: "5x5 cm", desc: "Visa Mỹ" }
      ];
      const ATTIRES = [
        { id: "white", label: "Áo trắng", desc: "Sơ mi trắng" },
        { id: "colorful", label: "Áo màu", desc: "Lịch sự" }
      ];

      // --- Prompt builder ---
      function buildIDPrompt({ gender, bg, keepFace, ratio, attire }) {
        const bgDescription = bg === "blue"
          ? "a solid, flat, azure blue background (Hex #0074D9). No gradients, no shadows, no studio backdrop texture."
          : "a solid, flat, pure white background (Hex #FFFFFF). No grey tones, no shadows, no corners, no floor lines. Completely uniform white.";
        const attireDescription = attire === "white"
          ? "A clean, simple white collared shirt."
          : "A professional, colorful button-down shirt or blouse (e.g., pastel blue, pink, floral pattern, or solid bright color). NOT a white shirt. Ensure the clothing color contrasts well with the background.";
        const base = gender === "female"
          ? "A professional passport photo of a Vietnamese woman with natural black hair. The hair must be neatly tucked behind ears so BOTH EARS are clearly visible."
          : "A professional passport photo of a Vietnamese man with natural black hair. BOTH EARS must be clearly visible.";
        const keep = keepFace
          ? "CRITICAL: Strictly preserve the original face, facial features, eyes, nose, mouth, skin texture. The hair color MUST REMAIN NATURAL BLACK. IT IS VITAL TO PRESERVE THE ORIGINAL HAIRSTYLE, HAIR LENGTH, AND TEXTURE. Do not change the haircut or hair volume. The identity must be identical. REQUIREMENT: Neatly tuck hair strands behind the ears to reveal them fully, but otherwise keep the hair exactly as in the reference image."
          : "";
        let ratioText = "vertical 3:4";
        if (ratio === "1:1") ratioText = "square 1:1";
        if (ratio === "3.5:4.5") ratioText = "vertical 3.5:4.5 (approximately 7:9)";
        return (
          `Generate ${base} ${keep} ` +
          `Attire: ${attireDescription} ` +
          `Expression: Neutral, mouth closed, eyes open looking straight ahead. ` +
          `Lighting: Soft, even, shadowless face lighting. ` +
          `Background: Strictly ${bgDescription}. ` +
          `Composition: Standard passport composition showing full head and shoulders. Ensure both shoulders are visible in the frame. Center the face. Both ears must be clearly visible. ` +
          `Technical: High resolution, sharp focus, ${ratioText} aspect ratio. ` +
          `Negative prompt: hair covering ears, hidden ears, ears covered, one ear hidden, changed hairstyle, different haircut, different hair length, cropped shoulders, neck crop, brown hair, dyed hair, light hair, altered face, messy hair, shadows on wall, two-tone background, studio floor, furniture.`
        );
      }

      // --- Gemini API call (no SDK, plain fetch) ---
      async function callGeminiImageAPI(apiKey, prompt, fileBlob) {
        const base64Data = await new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result.split(",")[1]);
          reader.onerror = reject;
          reader.readAsDataURL(fileBlob);
        });

        const body = {
          contents: [{
            parts: [
              { inline_data: { mime_type: fileBlob.type, data: base64Data } },
              { text: prompt }
            ]
          }],
          generationConfig: {
            responseModalities: ["IMAGE", "TEXT"]
          }
        };

        // Try gemini-2.0-flash-preview-image-generation first, fallback to imagen
        const model = "gemini-2.0-flash-preview-image-generation";
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });

        if (!res.ok) {
          const errText = await res.text();
          let errMsg = `Lỗi API ${res.status}`;
          try {
            const errJson = JSON.parse(errText);
            errMsg = errJson?.error?.message || errMsg;
          } catch {}
          throw new Error(errMsg);
        }

        const data = await res.json();
        const parts = data?.candidates?.[0]?.content?.parts || [];
        for (const part of parts) {
          if (part.inline_data) {
            return `data:${part.inline_data.mime_type};base64,${part.inline_data.data}`;
          }
        }
        throw new Error("Không tìm thấy ảnh trong phản hồi từ API. Vui lòng thử lại.");
      }

      // --- Settings Modal ---
      function SettingsModal({ apiKey, onClose, onSave }) {
        const [key, setKey] = useState(apiKey);
        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
            <div className="absolute inset-0 bg-slate-900/60 backdrop-blur-sm" onClick={onClose} />
            <div className="relative bg-white w-full max-w-md rounded-3xl shadow-2xl p-8 fade-in">
              <button onClick={onClose} className="absolute top-5 right-5 p-2 hover:bg-slate-100 rounded-full transition-colors">
                <Icon name="x" className="w-5 h-5 text-slate-400" />
              </button>
              <div className="flex items-center gap-3 mb-6">
                <div className="bg-indigo-100 p-3 rounded-2xl text-indigo-600">
                  <Icon name="settings" className="w-6 h-6 text-indigo-600" />
                </div>
                <h2 className="text-xl font-bold text-slate-800">Cài đặt API</h2>
              </div>
              <div className="space-y-4">
                <div>
                  <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-2 block">Gemini API Key</label>
                  <input
                    type="password"
                    placeholder="Nhập API Key của bạn..."
                    value={key}
                    onChange={e => setKey(e.target.value)}
                    className="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all font-mono text-sm"
                  />
                  <p className="mt-2 text-xs text-slate-400 leading-relaxed">
                    Lấy API Key miễn phí tại{" "}
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noreferrer" className="text-indigo-600 hover:underline">
                      Google AI Studio
                    </a>. Key được lưu an toàn trong trình duyệt.
                  </p>
                </div>
                <button
                  onClick={() => onSave(key)}
                  className="w-full py-3 bg-indigo-600 text-white font-bold rounded-xl hover:bg-indigo-700 transition-colors shadow-lg shadow-indigo-100"
                >
                  Lưu Cấu Hình
                </button>
              </div>
            </div>
          </div>
        );
      }

      // --- Main App ---
      function App() {
        const [gender, setGender] = useState("female");
        const [bg, setBg] = useState("blue");
        const [ratio, setRatio] = useState("3:4");
        const [attire, setAttire] = useState("white");
        const [keepFace, setKeepFace] = useState(true);
        const [apiKey, setApiKey] = useState(() => localStorage.getItem("GEMINI_API_KEY") || "");
        const [showSettings, setShowSettings] = useState(false);

        const [fileBlob, setFileBlob] = useState(null);
        const [uploadPreview, setUploadPreview] = useState(null);
        const [loading, setLoading] = useState(false);
        const [generatingPdf, setGeneratingPdf] = useState(false);
        const [errorMsg, setErrorMsg] = useState(null);
        const [resultUrl, setResultUrl] = useState(null);
        const fileInput = useRef(null);

        const handleFile = (file) => {
          setFileBlob(file);
          setErrorMsg(null);
          const r = new FileReader();
          r.onload = () => setUploadPreview(r.result);
          r.readAsDataURL(file);
        };

        const handleDrop = (e) => {
          e.preventDefault();
          const file = e.dataTransfer.files?.[0];
          if (file && file.type.startsWith("image/")) handleFile(file);
        };

        const handleGenerate = async () => {
          if (!fileBlob) return setErrorMsg("Vui lòng tải ảnh gốc trước.");
          if (!apiKey) { setShowSettings(true); return setErrorMsg("Vui lòng cấu hình Gemini API Key."); }
          setErrorMsg(null);
          setResultUrl(null);
          setLoading(true);
          try {
            const prompt = buildIDPrompt({ gender, bg, keepFace, ratio, attire });
            const url = await callGeminiImageAPI(apiKey, prompt, fileBlob);
            setResultUrl(url);
          } catch (e) {
            setErrorMsg("Tạo ảnh thất bại: " + (e.message || "Lỗi không xác định"));
          } finally {
            setLoading(false);
          }
        };

        const handleDownloadPNG = () => {
          if (!resultUrl) return;
          const a = document.createElement("a");
          a.href = resultUrl;
          a.download = `anh-the-${gender}-${bg}-${ratio.replace(":", "x")}.png`;
          a.click();
        };

        const handleDownloadPDF = async () => {
          if (!resultUrl || generatingPdf) return;
          setGeneratingPdf(true);
          try {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: "portrait", unit: "mm", format: "a4" });
            const pageW = 210, pageH = 297;
            let imgW = pageW - 20, imgH = imgW;
            if (ratio === "3:4") imgH = imgW * (4 / 3);
            else if (ratio === "3.5:4.5") imgH = imgW * (4.5 / 3.5);
            if (imgH > pageH - 20) {
              imgH = pageH - 20;
              if (ratio === "1:1") imgW = imgH;
              else if (ratio === "3:4") imgW = imgH * (3 / 4);
              else imgW = imgH * (3.5 / 4.5);
            }
            doc.addImage(resultUrl, "PNG", (pageW - imgW) / 2, (pageH - imgH) / 2, imgW, imgH);
            doc.save("anh-the-A4.pdf");
          } catch (e) {
            alert("Lỗi tạo PDF: " + e.message);
          } finally {
            setGeneratingPdf(false);
          }
        };

        const saveApiKey = (key) => {
          setApiKey(key);
          localStorage.setItem("GEMINI_API_KEY", key);
          setShowSettings(false);
          setErrorMsg(null);
        };

        const resultBoxClass = ratio === "1:1"
          ? "w-64 h-64"
          : ratio === "3:4"
          ? "w-56 h-72"
          : "w-56 h-72";

        return (
          <div className="min-h-screen flex flex-col">
            {/* Navbar */}
            <nav className="glass sticky top-0 z-40 px-6 py-4 flex items-center justify-between border-b border-slate-200">
              <div className="flex items-center gap-2">
                <div className="bg-indigo-600 p-2 rounded-lg shadow-lg shadow-indigo-200">
                  <Icon name="camera" className="w-5 h-5 text-white" />
                </div>
                <h1 className="text-xl font-bold tracking-tight text-slate-800 hidden sm:block">
                  Ảnh Thẻ <span className="text-indigo-600">AI</span>
                </h1>
              </div>
              <div className="flex items-center gap-3">
                <button
                  onClick={() => setShowSettings(true)}
                  className="p-2 hover:bg-slate-100 rounded-full transition-colors text-slate-600"
                  title="Cài đặt API Key"
                >
                  <Icon name="settings" className="w-5 h-5 text-slate-600" />
                </button>
                <a
                  href="https://ai.google.dev/"
                  target="_blank" rel="noreferrer"
                  className="text-xs font-medium text-slate-500 hover:text-indigo-600 transition-colors flex items-center gap-1 bg-slate-100 px-3 py-1.5 rounded-full"
                >
                  Powered by Gemini
                  <Icon name="external-link" className="w-3 h-3 text-slate-500" />
                </a>
              </div>
            </nav>

            <main className="flex-1 max-w-6xl mx-auto w-full px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
              {/* Left Panel */}
              <div className="lg:col-span-5 space-y-6">
                {/* Upload */}
                <section className="bg-white rounded-3xl shadow-sm border border-slate-200 p-6">
                  <div className="flex items-center gap-2 mb-5">
                    <div className="w-6 h-6 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 text-xs font-bold">1</div>
                    <h2 className="font-semibold text-slate-800">Tải ảnh chân dung</h2>
                  </div>
                  <div
                    onClick={() => fileInput.current?.click()}
                    onDrop={handleDrop}
                    onDragOver={e => e.preventDefault()}
                    className="relative group cursor-pointer border-2 border-dashed rounded-2xl transition-all duration-300 flex flex-col items-center justify-center overflow-hidden h-64"
                    style={{ borderColor: uploadPreview ? '#a5b4fc' : '#e2e8f0', background: uploadPreview ? '#eef2ff' : '#f8fafc' }}
                  >
                    {uploadPreview ? (
                      <>
                        <img src={uploadPreview} alt="Preview" className="w-full h-full object-cover" />
                        <div className="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                          <Icon name="refresh-cw" className="w-8 h-8 text-white" />
                        </div>
                      </>
                    ) : (
                      <div className="text-center p-6">
                        <div className="w-16 h-16 bg-white rounded-2xl shadow-sm flex items-center justify-center mx-auto mb-4">
                          <Icon name="image" className="w-8 h-8 text-slate-300 group-hover:text-indigo-500 transition-colors" />
                        </div>
                        <p className="text-sm font-medium text-slate-600">Kéo thả hoặc nhấn để tải ảnh</p>
                        <p className="text-xs text-slate-400 mt-1">Hỗ trợ JPG, PNG, WebP</p>
                      </div>
                    )}
                    <input
                      ref={fileInput}
                      type="file"
                      accept="image/*"
                      className="hidden"
                      onChange={e => e.target.files?.[0] && handleFile(e.target.files[0])}
                    />
                  </div>
                </section>

                {/* Config */}
                <section className="bg-white rounded-3xl shadow-sm border border-slate-200 p-6">
                  <div className="flex items-center gap-2 mb-5">
                    <div className="w-6 h-6 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 text-xs font-bold">2</div>
                    <h2 className="font-semibold text-slate-800">Tùy chỉnh thông số</h2>
                  </div>

                  <div className="space-y-6">
                    {/* Gender */}
                    <div>
                      <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 block">Giới tính</label>
                      <div className="grid grid-cols-2 gap-3">
                        {GENDERS.map(g => (
                          <button key={g.id} onClick={() => setGender(g.id)}
                            className={`flex items-center justify-center gap-2 px-4 py-3 rounded-xl text-sm font-medium transition-all border
                              ${gender === g.id ? 'bg-indigo-600 text-white border-indigo-600 shadow-md shadow-indigo-100' : 'bg-white text-slate-600 border-slate-200 hover:border-indigo-300 hover:bg-indigo-50'}`}>
                            <Icon name="user" className="w-4 h-4" /> {g.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    {/* Background */}
                    <div>
                      <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 block">Màu nền</label>
                      <div className="grid grid-cols-2 gap-3">
                        {BACKGROUNDS.map(b => (
                          <button key={b.id} onClick={() => setBg(b.id)}
                            className={`flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all border
                              ${bg === b.id ? 'bg-indigo-50 border-indigo-400 ring-2 ring-indigo-500 ring-offset-2' : 'bg-white text-slate-600 border-slate-200 hover:border-indigo-200'}`}>
                            <div className={`w-5 h-5 rounded-full ${b.twColor}`} />
                            {b.label}
                          </button>
                        ))}
                      </div>
                    </div>

                    {/* Ratio */}
                    <div>
                      <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 block">Kích thước</label>
                      <div className="space-y-2">
                        {RATIOS.map(r => (
                          <button key={r.id} onClick={() => setRatio(r.id)}
                            className={`w-full flex items-center justify-between px-4 py-3 rounded-xl text-sm font-medium transition-all border
                              ${ratio === r.id ? 'bg-indigo-600 text-white border-indigo-600 shadow-md' : 'bg-white text-slate-600 border-slate-200 hover:border-indigo-200'}`}>
                            <span>{r.label}</span>
                            <span className={`text-xs ${ratio === r.id ? 'text-indigo-100' : 'text-slate-400'}`}>{r.desc}</span>
                          </button>
                        ))}
                      </div>
                    </div>

                    {/* Attire */}
                    <div>
                      <label className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 block">Trang phục</label>
                      <div className="grid grid-cols-2 gap-3">
                        {ATTIRES.map(a => (
                          <button key={a.id} onClick={() => setAttire(a.id)}
                            className={`flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl text-sm font-medium transition-all border
                              ${attire === a.id ? 'bg-indigo-600 text-white border-indigo-600 shadow-md' : 'bg-white text-slate-600 border-slate-200 hover:border-indigo-200'}`}>
                            <span>{a.label}</span>
                            <span className={`text-xs ${attire === a.id ? 'text-indigo-100' : 'text-slate-400'}`}>{a.desc}</span>
                          </button>
                        ))}
                      </div>
                    </div>

                    {/* Keep face toggle */}
                    <div
                      onClick={() => setKeepFace(v => !v)}
                      className="flex items-center justify-between p-4 bg-slate-50 rounded-2xl border border-slate-100 cursor-pointer hover:bg-slate-100 transition-colors"
                    >
                      <div className="flex items-center gap-3">
                        <div className={`p-2 rounded-lg ${keepFace ? 'bg-emerald-100' : 'bg-slate-200'}`}>
                          <Icon name="shield-check" className={`w-5 h-5 ${keepFace ? 'text-emerald-600' : 'text-slate-400'}`} />
                        </div>
                        <div>
                          <p className="text-sm font-semibold text-slate-800">Giữ nguyên khuôn mặt</p>
                          <p className="text-xs text-slate-500">Đảm bảo độ nhận diện cao nhất</p>
                        </div>
                      </div>
                      <div className={`w-10 h-5 rounded-full relative transition-colors ${keepFace ? 'bg-emerald-500' : 'bg-slate-300'}`}>
                        <div className={`absolute top-1 w-3 h-3 bg-white rounded-full shadow transition-all ${keepFace ? 'left-6' : 'left-1'}`} />
                      </div>
                    </div>
                  </div>

                  {/* Generate button */}
                  <div className="mt-8">
                    <button
                      onClick={handleGenerate}
                      disabled={loading}
                      className={`w-full py-4 rounded-2xl text-white font-bold text-lg shadow-xl transition-all active:scale-95 flex items-center justify-center gap-3
                        ${loading ? 'bg-slate-400 cursor-not-allowed' : 'bg-indigo-600 hover:bg-indigo-700 shadow-indigo-200'}`}
                    >
                      {loading ? (
                        <>
                          <svg className="animate-spin w-6 h-6 text-white" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" strokeOpacity=".3"/>
                            <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" strokeWidth="4" strokeLinecap="round"/>
                          </svg>
                          <span>Đang vẽ ảnh...</span>
                        </>
                      ) : (
                        <>
                          <Icon name="refresh-cw" className="w-6 h-6 text-white" />
                          <span>Tạo Ảnh Ngay</span>
                        </>
                      )}
                    </button>

                    {errorMsg && (
                      <div className="mt-4 p-4 bg-rose-50 border border-rose-100 rounded-2xl flex items-start gap-3 fade-in">
                        <Icon name="alert-circle" className="w-5 h-5 text-rose-500 flex-shrink-0 mt-0.5" />
                        <p className="text-sm text-rose-700 font-medium">{errorMsg}</p>
                      </div>
                    )}
                  </div>
                </section>
              </div>

              {/* Right Panel */}
              <div className="lg:col-span-7">
                <div className="bg-white rounded-3xl shadow-sm border border-slate-200 p-6 h-full flex flex-col">
                  <div className="flex items-center justify-between mb-6">
                    <div className="flex items-center gap-2">
                      <div className="w-6 h-6 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 text-xs font-bold">3</div>
                      <h2 className="font-semibold text-slate-800">Kết quả AI</h2>
                    </div>
                    {resultUrl && (
                      <div className="flex items-center gap-1 text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full border border-emerald-100">
                        <Icon name="check" className="w-3 h-3 text-emerald-600" /> HOÀN TẤT
                      </div>
                    )}
                  </div>

                  <div className="flex-1 bg-slate-50 rounded-2xl border border-slate-100 flex items-center justify-center p-8 min-h-80">
                    {loading ? (
                      <div className="flex flex-col items-center text-center">
                        <div className="relative w-24 h-24">
                          <svg className="animate-spin w-24 h-24 text-indigo-200" viewBox="0 0 96 96" fill="none">
                            <circle cx="48" cy="48" r="44" stroke="currentColor" strokeWidth="8"/>
                            <path d="M48 4a44 44 0 0 1 44 44" stroke="#4f46e5" strokeWidth="8" strokeLinecap="round"/>
                          </svg>
                        </div>
                        <h3 className="mt-6 text-lg font-bold text-slate-800">AI đang xử lý...</h3>
                        <p className="text-sm text-slate-500 max-w-xs mt-2">Quá trình này thường mất 10–15 giây để đạt chất lượng tốt nhất.</p>
                      </div>
                    ) : resultUrl ? (
                      <div className="relative fade-in">
                        <div className={`bg-white shadow-2xl rounded-lg overflow-hidden border-8 border-white ${resultBoxClass}`}>
                          <img src={resultUrl} alt="Ảnh thẻ AI" className="w-full h-full object-cover" />
                        </div>
                        <div className="absolute -bottom-4 -right-4 bg-white p-3 rounded-2xl shadow-xl border border-slate-100">
                          <Icon name="check" className="w-6 h-6 text-emerald-500" />
                        </div>
                      </div>
                    ) : (
                      <div className="text-center text-slate-300">
                        <div className="w-24 h-24 bg-white rounded-3xl shadow-sm flex items-center justify-center mx-auto mb-4 border border-slate-100">
                          <Icon name="image" className="w-12 h-12 text-slate-200" />
                        </div>
                        <p className="text-sm font-medium">Ảnh kết quả sẽ hiển thị tại đây</p>
                      </div>
                    )}
                  </div>

                  <div className="mt-8 grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <button
                      onClick={handleDownloadPNG}
                      disabled={!resultUrl}
                      className={`flex items-center justify-center gap-2 py-4 rounded-2xl font-bold transition-all
                        ${resultUrl ? 'bg-slate-900 text-white hover:bg-slate-700 shadow-lg cursor-pointer' : 'bg-slate-100 text-slate-400 cursor-not-allowed'}`}
                    >
                      <Icon name="download" className={`w-5 h-5 ${resultUrl ? 'text-white' : 'text-slate-400'}`} />
                      Tải ảnh PNG
                    </button>
                    <button
                      onClick={handleDownloadPDF}
                      disabled={!resultUrl || generatingPdf}
                      className={`flex items-center justify-center gap-2 py-4 rounded-2xl font-bold transition-all
                        ${resultUrl ? 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg cursor-pointer' : 'bg-slate-100 text-slate-400 cursor-not-allowed'}`}
                    >
                      {generatingPdf ? (
                        <svg className="animate-spin w-5 h-5 text-white" viewBox="0 0 24 24" fill="none">
                          <circle cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" strokeOpacity=".3"/>
                          <path d="M12 2a10 10 0 0 1 10 10" stroke="currentColor" strokeWidth="4" strokeLinecap="round"/>
                        </svg>
                      ) : (
                        <Icon name="file-text" className={`w-5 h-5 ${resultUrl ? 'text-white' : 'text-slate-400'}`} />
                      )}
                      {generatingPdf ? "Đang tạo PDF..." : "Tải file in PDF (A4)"}
                    </button>
                  </div>
                </div>
              </div>
            </main>

            <footer className="py-8 border-t border-slate-200 text-center space-y-1">
              <p className="text-xs text-slate-400 font-medium">© 2024 Ảnh Thẻ AI. Công cụ hỗ trợ tạo ảnh thẻ chuyên nghiệp bằng trí tuệ nhân tạo.</p>
              <p className="text-xs text-slate-500 font-semibold">Tác giả: Thầy Tống Phước Khải</p>
              <a href="mailto:phuockhai79@gmail.com" className="text-xs text-indigo-500 hover:underline">phuockhai79@gmail.com</a>
            </footer>

            {showSettings && (
              <SettingsModal
                apiKey={apiKey}
                onClose={() => setShowSettings(false)}
                onSave={saveApiKey}
              />
            )}
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
